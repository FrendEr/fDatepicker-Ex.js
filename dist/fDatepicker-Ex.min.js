!function(a,b){"function"==typeof define&&define.amd?define(["jquery"],function(a){return b()}):"undefined"!=typeof module&&module.exports?module.exports=b():window[a]=b()}("Datepicker",function(){"use strict";function a(c){var c=$.extend(a.DEFAULT,c);this.$container=$(c.container),this.initDate=b.formatDateObj(c.initDate&&"string"==typeof c.initDate?new Date(c.initDate):c.initDate),this.startDate=b.formatDateObj("string"==typeof c.startDate?new Date(c.startDate):c.startDate),this.endDate=b.formatDateObj("string"==typeof c.endDate?new Date(c.endDate):c.endDate),this.weekFixed=c.singleFrame?!1:c.weekFixed,this.initFrames=c.initFrame,this.restFrames=0,this.loadFrames=c.loadFrames,this.tmpYear=0,this.tmpMonth=0,this.loadOffset=c.loadOffset,this.singleFrame=c.singleFrame,this.i18n=c.i18n,this.selectStart=b.formatDateObj("string"==typeof c.selectStart?new Date(c.selectStart):c.selectStart),this.selectEnd=b.formatDateObj("string"==typeof c.selectEnd?new Date(c.selectEnd):c.selectEnd),this.startCallback=c.startCallback,this.endCallback=c.endCallback,this.completeCallback=c.completeCallback;var d=this;$(window).on("scroll",$.proxy(this.scrollLoad,this)),this.$container.on("click","span[data-date]",$.proxy(this.initEvents,this)),this.singleFrame&&this.$container.on("click","#prevBtn, #nextBtn",function(a){b.monthExchange(a.target,d.tmpYear||d.getInitYear()||d.getStartYear(),0!=d.tmpYear&&d.tmpMonth>=0?d.tmpMonth:d.getInitMonth()||d.getStartMonth(),d)}),this.init()}a.VERSION="1.0.0",a.DEFAULT={container:"",initDate:"",selectStart:"",selectEnd:"",startDate:"",endDate:"",weekFixed:!0,singleFrame:!1,initFrames:3,loadFrames:3,loadOffset:100,i18n:!1,startCallback:$.noop,endCallback:$.noop,completeCallback:$.noop},a.prototype={constructor:a,init:function(){var a=this,c=this.singleFrame&&this.getInitYear()?this.getInitYear():this.getStartYear(),d=this.singleFrame&&this.getInitMonth()?this.getInitMonth():this.getStartMonth(),e=this.getEndYear(),f=this.getEndMonth();if(!(c>e||c==e&&d>f)){var g='<div style="height: 22px;"></div>                            <div class="datepicker-table fixed">                                <span class="dp-th">日</span>                                <span class="dp-th">一</span>                                <span class="dp-th">二</span>                                <span class="dp-th">三</span>                                <span class="dp-th">四</span>                                <span class="dp-th">五</span>                                <span class="dp-th">六</span>                            </div>';if(this.weekFixed&&this.$container.append(g),this.singleFrame||c==e&&d==f)return void this.$container.append(b.renderSinglePicker(c,d,a));if(!this.singleFrame)if(this.restFrames=12*(e-c)+f-d-this.initFrames,this.restFrames>0){var h=this.tmpYear=c+(d+this.initFrames>11?1:0),i=this.tmpMonth=(d+this.initFrames-1)%12;this.$container.append(b.renderMultiplePicker(c,d,h,i,a))}else this.$container.append(b.renderMultiplePicker(c,d,e,f,a))}},initEvents:function(a){var c="span"==a.target.tagName.toLowerCase()?$(a.target):$(a.target).parents("span");if(!c.is(".is-outdate")&&!c.is(".is-today")){if(this.$container.find(".is-inner").removeClass("is-inner"),this.selectStart)if(this.selectStart&&!this.selectEnd){var d=(new Date(c.data("date"))-this.selectStart)/864e5;this.selectStart<new Date(c.data("date"))&&20>d?(c.addClass("selected check-out"),this.selectEnd=new Date(c.data("date")),this.completeCallback.call(this,b.formatDateString(this.selectStart,"-"),b.formatDateString(this.selectEnd,"-"),d)):(this.$container.find(".selected").removeClass("selected check-in check-out"),c.addClass("selected check-in"),this.selectStart=new Date(c.data("date")),this.startCallback.call(this,b.formatDateString(this.selectStart,"-")))}else this.selectStart&&this.selectEnd&&(this.$container.find(".selected").removeClass("selected check-in check-out"),c.addClass("selected check-in"),this.selectStart=new Date(c.data("date")),this.selectEnd="",this.startCallback.call(this,b.formatDateString(this.selectStart,"-")));else c.addClass("selected check-in"),this.selectStart=new Date(c.data("date")),this.startCallback.call(this,b.formatDateString(this.selectStart,"-"));this.selectStart&&this.selectEnd&&this.setInnerDates()}},setInnerDates:function(){for(var a=this,c=a.$container,d=b.formatDateString(a.selectStart,"/"),e=b.formatDateString(a.selectEnd,"/"),f=(a.selectEnd-a.selectStart)/864e5-1,g=c.find('span[data-date="'+d+'"]'),h=c.find('span[data-date="'+e+'"]'),i=g.next("[data-date]"),j=h.prev("[data-date]");f;)i.length&&f--,i.addClass("is-inner"),i=i.next("[data-date]"),j.length&&f&&f--,j.addClass("is-inner"),j=j.prev("[data-date]")},getInitYear:function(){return this.initDate.getFullYear()},getInitMonth:function(){return this.initDate.getMonth()},getStartYear:function(){return this.startDate.getFullYear()},getStartMonth:function(){return this.startDate.getMonth()},getEndYear:function(){return this.endDate.getFullYear()},getEndMonth:function(){return this.endDate.getMonth()},getEndDate:function(){return this.endDate},scrollLoad:function(){if(!(this.restFrames<=0)){var a,c,d=this,e=$(window),f=$(document),g=this.tmpYear,h=this.tmpMonth+1;f.height()-e.height()-e.scrollTop()<this.loadOffset&&(this.restFrames<=this.loadFrames?(this.restFrames=0,a=this.getEndYear(),c=this.getEndMonth(),this.$container.append(b.renderMultiplePicker(g,h,a,c,d))):(this.restFrames-=this.loadFrames,a=this.tmpYear=g+(h+this.loadFrames>11?1:0),c=this.tmpMonth=(h+this.loadFrames-1)%12,this.$container.append(b.renderMultiplePicker(g,h,a,c,d))))}}};var b={weeks:["日","一","二","三","四","五","六"],weeksi18n:["Sun","Mon","Tues","Wed","Thur","Fri","Sat"],months:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],monthsi18n:["January","February","March","April","May","June","July","August","September","October","November","December"],holiday:{"1/1":"元旦","5/1":"劳动节","6/1":"儿童节","10/1":"国庆节","12/25":"圣诞节"},getCurrentDate:function(){return new Date},getMonthFirstDay:function(a,b){return new Date(a,b,1).getDay()},getMonthLastDay:function(a,b){return new Date(a,b+1,0).getDate()},formatDateString:function(a,b){var a="string"==typeof a?new Date(a):a;return parseInt(a.getFullYear())+b+(parseInt(a.getMonth())+1)+b+parseInt(a.getDate())},formatDateObj:function(a){var a="string"==typeof a?new Date(a):a;return new Date(a.getFullYear()+"/"+(parseInt(a.getMonth())+1)+"/"+parseInt(a.getDate()))},fillArr:function(a,b){for(var c=this.getMonthFirstDay(a,b),d=this.getMonthLastDay(a,b),e=d,f=c+d>36?new Array(42):c+d>28?new Array(35):new Array(28),g=c,h=0;e>h;h++,g++)f[g]=a+"/"+(b+1)+"/"+(h+1);return f},monthExchange:function(a,b,c,d){var e=$(a),f=e[0].className;-1==f.indexOf("disable-btn")&&(-1!=f.indexOf("prev-btn")&&(c-1>=0?function(){d.tmpYear=b,d.tmpMonth=c-1}():function(){d.tmpYear=b-1,d.tmpMonth=11}(),d.$container.empty().append(this.renderSinglePicker(d.tmpYear,d.tmpMonth,d))),-1!=f.indexOf("next-btn")&&(11>=c+1?function(){d.tmpYear=b,d.tmpMonth=c+1}():function(){d.tmpYear=b+1,d.tmpMonth=0}(),d.$container.empty().append(this.renderSinglePicker(d.tmpYear,d.tmpMonth,d))))},renderSinglePicker:function(a,b,c){var d=this.fillArr(a,b),e=this.getCurrentDate(),f=c.getEndDate(),g=c.selectStart&&c.selectStart.getTime(),h=c.selectEnd&&c.selectEnd.getTime(),i=this.renderPickerHead(a,b,c);return i.append(this.renderPickerBody(d,e,f,g,h))},renderPickerHead:function(a,b,c){var d=c.i18n?this.weeksi18n:this.weeks,e=c.i18n?this.monthsi18n[b]+" "+a:a+"年 "+this.months[b],f=c.singleFrame?'<i id="prevBtn" class="prev-btn '+(a==c.getStartYear()&&b==c.getStartMonth()?"disable-btn":"")+'">&lt;</i>':"",g=c.singleFrame?'<i id="nextBtn" class="next-btn '+(a==c.getEndYear()&&b==c.getEndMonth()?"disable-btn":"")+'">&gt;</i>':"",h=f+e+g,i=$('<div class="datepicker-table"><h2 id="dpHeader" class="datepicker-header">'+h+"</h2>"+function(){var a="";if(!c.weekFixed)for(var b=0;b<d.length;b++)a+='<span class="dp-th">'+d[b]+"</span>";return a}()+"</div>");return i},renderPickerBody:function(a,b,c,d,e){for(var f="",g=0;g<a.length;g++)void 0==a[g]?f+="<span></span>":function(g){var h=a[g].split("/"),i=parseInt(h[0]),j=parseInt(h[1])-1,k=parseInt(h[2]),l="";l+=new Date(a[g])<b||new Date(a[g])>c?"is-outdate ":"",l+=b.getFullYear()==i&&parseInt(b.getMonth())==j&&parseInt(b.getDate())==k?"is-today ":"",l+=-1!=l.indexOf("is-outdate")?"":-1!=l.indexOf("is-today")?"":new Date(a[g]).getTime()==d?"selected check-in":new Date(a[g]).getTime()==e?"selected check-out":new Date(a[g]).getTime()>d&&new Date(a[g]).getTime()<e?"is-inner":"",(g%7==0||g%7==6)&&(l+=" is-weekend"),f+='<span class="'+l+'" data-date="'+a[g]+'"><i>'+k+"</i></span>"}(g);return f},renderMultiplePicker:function(a,b,c,d,e){for(var f=c-a,g=12*f+d-b,h=$("<div/>"),i=0;g>=i;i++){var j=(b+i)%12,k=b+i>=12?a+1:a;h.append(this.renderSinglePicker(k,j,e))}return h}};return a});